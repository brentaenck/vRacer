<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vRacer Track Editor Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: #e0e0e0;
        }
        .test-results {
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .test-pass { background: #0f3d0f; border: 1px solid #4caf50; }
        .test-fail { background: #3d0f0f; border: 1px solid #f44336; }
        .test-pending { background: #3d3d0f; border: 1px solid #ff9800; }
        button {
            margin: 5px;
            padding: 8px 15px;
            border: none;
            border-radius: 3px;
            background: #333;
            color: #e0e0e0;
            cursor: pointer;
        }
        button:hover { background: #555; }
    </style>
</head>
<body>
    <h1>üèÅ vRacer Track Editor Test</h1>
    
    <div class="test-results" id="testResults">
        <h3>Running Track Editor Integration Tests...</h3>
        <div id="testLog"></div>
    </div>
    
    <div class="controls">
        <button id="runTests">Run All Tests</button>
        <button id="clearLog">Clear Log</button>
    </div>
    
    <!-- Add minimal HTML elements needed for track editor -->
    <div style="display: none;">
        <input id="editorToggle" type="checkbox" />
        <div id="trackEditorSection">Track Editor Section</div>
        <div id="trackEditorPanel" style="display: none;">Editor Panel</div>
        <div id="configModal"></div>
    </div>

    <script type="module">
        import { isFeatureEnabled } from './src/features.js'
        import { initializeTrackEditor, isEditorActive } from './src/track-editor-ui.js'

        const testLog = document.getElementById('testLog')
        const testResults = document.getElementById('testResults')

        function logTest(name, passed, details = '') {
            const div = document.createElement('div')
            div.innerHTML = `
                <strong>${passed ? '‚úÖ' : '‚ùå'} ${name}</strong>
                ${details ? `<br><small>${details}</small>` : ''}
            `
            testLog.appendChild(div)
            console.log(`${passed ? 'PASS' : 'FAIL'}: ${name}`, details)
        }

        function runTests() {
            testLog.innerHTML = '<h4>Test Results:</h4>'
            testResults.className = 'test-results test-pending'
            
            let passCount = 0
            let totalTests = 0

            // Test 1: Feature flag check
            totalTests++
            const trackEditorEnabled = isFeatureEnabled('trackEditor')
            if (trackEditorEnabled) {
                logTest('Track Editor Feature Flag', true, 'Feature is properly enabled')
                passCount++
            } else {
                logTest('Track Editor Feature Flag', false, 'Feature flag not enabled')
            }

            // Test 2: Initialize track editor
            totalTests++
            try {
                initializeTrackEditor()
                logTest('Track Editor Initialization', true, 'No errors during initialization')
                passCount++
            } catch (error) {
                logTest('Track Editor Initialization', false, `Error: ${error.message}`)
            }

            // Test 3: Editor active state
            totalTests++
            const initiallyActive = isEditorActive()
            if (!initiallyActive) {
                logTest('Initial Editor State', true, 'Editor correctly starts inactive')
                passCount++
            } else {
                logTest('Initial Editor State', false, 'Editor should start inactive')
            }

            // Test 4: Toggle element exists
            totalTests++
            const toggleElement = document.getElementById('editorToggle')
            if (toggleElement) {
                logTest('Toggle Element', true, 'Editor toggle element found')
                passCount++
            } else {
                logTest('Toggle Element', false, 'Editor toggle element not found')
            }

            // Test 5: Try toggling editor
            totalTests++
            try {
                if (toggleElement) {
                    toggleElement.checked = true
                    toggleElement.dispatchEvent(new Event('change'))
                    
                    setTimeout(() => {
                        const nowActive = isEditorActive()
                        if (nowActive) {
                            logTest('Toggle Functionality', true, 'Editor successfully activated')
                            passCount++
                        } else {
                            logTest('Toggle Functionality', false, 'Editor did not activate')
                        }
                        
                        // Final results
                        const finalResults = `${passCount}/${totalTests} tests passed`
                        const resultsDiv = document.createElement('div')
                        resultsDiv.innerHTML = `<h4>Final Results: ${finalResults}</h4>`
                        testLog.appendChild(resultsDiv)
                        
                        testResults.className = passCount === totalTests ? 'test-results test-pass' : 'test-results test-fail'
                    }, 100)
                }
            } catch (error) {
                logTest('Toggle Functionality', false, `Error: ${error.message}`)
            }
        }

        document.getElementById('runTests').addEventListener('click', runTests)
        document.getElementById('clearLog').addEventListener('click', () => {
            testLog.innerHTML = ''
            testResults.className = 'test-results test-pending'
        })

        // Auto-run tests on load
        setTimeout(runTests, 500)
    </script>
</body>
</html>
